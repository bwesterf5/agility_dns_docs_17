

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>10. DNS Services Beyond GSLB with BIG-IP DNS (201) &mdash; Agility 2017 - DNS 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Agility 2017 - DNS 0.1 documentation" href="index.html"/>
        <link rel="prev" title="9. BIG-IQ" href="big-iq/index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Agility 2017 - DNS
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="lab_environment/index.html">1. Lab Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="gslb/index.html">2. GSLB</a></li>
<li class="toctree-l1"><a class="reference internal" href="cache/index.html">3. Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="dnsx/index.html">4. Authoritative Slave</a></li>
<li class="toctree-l1"><a class="reference internal" href="irules/index.html">5. iRules</a></li>
<li class="toctree-l1"><a class="reference internal" href="firewall/index.html">6. Firewall</a></li>
<li class="toctree-l1"><a class="reference internal" href="dnssec/index.html">7. DNS Sec</a></li>
<li class="toctree-l1"><a class="reference internal" href="routing/index.html">8. Route Health Injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="big-iq/index.html">9. BIG-IQ</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">10. DNS Services Beyond GSLB with BIG-IP DNS (201)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#authoritative-ns-slave-from-off-box-bind">10.1. AUTHORITATIVE NS: SLAVE FROM OFF-BOX BIND</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuring-dns-logging">10.1.1. Configuring DNS Logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-new-dns-profile">10.1.2. Create a new DNS Profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-dns-listeners">10.1.3. Create DNS Listeners</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-nameserver-for-hidden-master">10.1.4. Create a Nameserver for Hidden Master</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-zone-to-transfer-from-hidden-master">10.1.5. Create a zone to transfer from Hidden Master</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enable-dnssec-for-the-zone">10.1.6. Enable DNSSEC for the zone</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#authoritative-name-server-slave-from-on-box-bind">10.2. Authoritative Name Server: slave from ON-BOX BIND</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">10.2.1. Create a new DNS Profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#edit-dns-listeners">10.2.2. Edit DNS Listeners</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-student1-com-zone-using-zonerunner">10.2.3. Create a Student1.com zone using ZoneRunner</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-nameserver-for-on-box-bind">10.2.4. Create a Nameserver for on-box BIND</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-dns-express-zone-to-transfer-from-zonerunner">10.2.5. Create a DNS Express zone to transfer from ZoneRunner</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#slaving-off-of-dns-express">10.3. Slaving off of DNS Express</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6">10.3.1. Create a new DNS Profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">10.3.2. Edit DNS Listeners</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-nameservers-for-zone-transfer-clients">10.3.3. Create Nameservers for Zone Transfer Clients</a></li>
<li class="toctree-l3"><a class="reference internal" href="#edit-student2-zones-on-bigip2-to-allow-zone-transfers">10.3.4. Edit Student2 Zones on BIGIP2 to allow Zone transfers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#add-student2-com-zone-to-dns-express-on-bigip1">10.3.5. Add Student2.com zone to DNS Express on BIGIP1</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#transparent-caching">10.4. Transparent Caching</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-a-dns-cache">10.4.1. Create a DNS Cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">10.4.2. Create a new DNS Profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-dns-monitor">10.4.3. Create a DNS Monitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-resolver-pool">10.4.4. Create a Resolver Pool</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-new-external-dns-listener">10.4.5. Create a new External DNS Listener</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#resolver-cache">10.5. Resolver Cache</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-a-new-dns-cache">10.5.1. Create a new DNS Cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">10.5.2. Create a new DNS Profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#edit-dns-listener">10.5.3. Edit DNS Listener</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dnssec-validating-resolver">10.6. DNSSEC Validating Resolver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id12">10.6.1. Create a new DNS Cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">10.6.2. Create a new DNS Profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">10.6.3. Edit DNS Listener</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#forwarders">10.7. Forwarders</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#add-forwarder-to-existing-cache">10.7.1. Add Forwarder to Existing Cache</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dns-201-class-is-complete-thanks-for-attending">10.8. DNS 201 class is complete !  Thanks for attending!</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Agility 2017 - DNS</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>10. DNS Services Beyond GSLB with BIG-IP DNS (201)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/dns201_agility2017.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p>Agility 2017 Hands-on Lab Guide</p>
<p>Written for: TMOS<sup>®</sup> v13.0.0</p>
<p>Presented by: DNS 2017 F5 Agility Team</p>
<div class="section" id="dns-services-beyond-gslb-with-big-ip-dns-201">
<h1>10. DNS Services Beyond GSLB with BIG-IP DNS (201)<a class="headerlink" href="#dns-services-beyond-gslb-with-big-ip-dns-201" title="Permalink to this headline">¶</a></h1>
<div class="section" id="authoritative-ns-slave-from-off-box-bind">
<h2>10.1. AUTHORITATIVE NS: SLAVE FROM OFF-BOX BIND<a class="headerlink" href="#authoritative-ns-slave-from-off-box-bind" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Objective:</strong> In this use-case, you will configure GTM as the
authoritative slave using an off-box BIND server as the hidden
master. This is a very common architecture to serve either external
or internal zones with large scale RPS via DNS Express. You will
configure the following common components:</li>
<li>DNS Profile and Listeners</li>
<li>DNS Express</li>
<li>DNS Query Logging</li>
<li>DNS Statistics</li>
<li>DNSSEC signing</li>
<li>Estimated completion time: 25 minutes</li>
</ul>
<div class="section" id="configuring-dns-logging">
<h3>10.1.1. Configuring DNS Logging<a class="headerlink" href="#configuring-dns-logging" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>You are going to configure DNS query and response logging. To do
this, you must tell GTM where to send logs to (a log publisher) and
what specifically to log (DNS logging profile).</li>
<li>For lab purposes, we are going to use local-syslog as our logging
destination.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">remote high-speed logging is highly recommended for production environments.</p>
</div>
<ul class="simple">
<li>Log in to <a class="reference external" href="https://gtm1.site1.example.com">https://gtm1.site1.example.com</a> from the jumpbox
desktop and using user: <em>admin</em> password: <em>admin</em></li>
<li>In the GUI, navigate to: <strong>System &gt; Logs &gt; Configuration &gt; Log Publishers: Create</strong></li>
<li>Create a new DNS Log Publisher as shown in the table below.</li>
</ul>
<p><em>Keep the defaults if not noted in the table.</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">dns-local-syslog</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Destinations</strong></td>
<td>Move local-syslog to Selected column</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Click <strong>Finished</strong> to create.</li>
<li>In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Profiles &gt; Other &gt; DNS Logging: Create</strong></li>
<li>Create a new DNS logging profile as shown in the table below.</li>
</ul>
<p><em>Keep the defaults if not noted in the table.</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="47%" />
<col width="53%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">dns-logging</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Log Publisher</strong></td>
<td>Select dns-local-syslog</td>
</tr>
<tr class="row-odd"><td><strong>Log Responses</strong></td>
<td>Enabled</td>
</tr>
<tr class="row-even"><td><strong>Include Query ID</strong></td>
<td>Enabled</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Click <strong>Finished</strong> to create.</li>
<li>Your new dns-logging profile should now have all options enabled.</li>
</ul>
</div>
<div class="section" id="create-a-new-dns-profile">
<h3>10.1.2. Create a new DNS Profile<a class="headerlink" href="#create-a-new-dns-profile" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>A DNS profile tells the DNS Listener how to process DNS traffic.
We’re going to make some tweaks for our use-case and lab environment.</li>
<li>In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Profiles &gt; DNS: Create</strong></li>
<li>Create a new DNS profile as shown in the table below.</li>
</ul>
<p><em>Keep the defaults if not noted in the table.</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="53%" />
<col width="47%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">AuthNS-offbox-BIND</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Unhandled Query Action</strong></td>
<td>Drop</td>
</tr>
<tr class="row-odd"><td><strong>Use BIND Server on Big-IP</strong></td>
<td>Disabled</td>
</tr>
<tr class="row-even"><td><strong>Logging</strong></td>
<td>Enabled</td>
</tr>
<tr class="row-odd"><td><strong>Logging Profile</strong></td>
<td>dns-logging</td>
</tr>
<tr class="row-even"><td><strong>AVR Statistics Sampling Rate</strong></td>
<td>Enabled; 1/1 queries sampled</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Click <strong>Finished</strong> to create.</li>
<li>For lab purposes, we are going to use sample all DNS queries with AVR.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">production sampling rates would be a much lower rate
as this would severely impact performance.</p>
</div>
</div>
<div class="section" id="create-dns-listeners">
<h3>10.1.3. Create DNS Listeners<a class="headerlink" href="#create-dns-listeners" title="Permalink to this headline">¶</a></h3>
<p>We are going to create both UDP and TCP external listeners. The
external Listener will be our target IP address when querying GTM.</p>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Listeners &gt; Listener List: Create</strong></li>
<li>Create two <strong>external</strong> Listeners as shown in the tables below.</li>
</ul>
<p><em>Keep the defaults if not noted in the table.</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">external-listener-UDP</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Destination</strong></td>
<td>Host: 203.0.113.8</td>
</tr>
<tr class="row-odd"><td><strong>VLAN Traffic</strong></td>
<td>Enabled on..</td>
</tr>
<tr class="row-even"><td><strong>VLANs and Tunnels</strong></td>
<td>External</td>
</tr>
<tr class="row-odd"><td><strong>DNS Profile</strong></td>
<td>AuthNS-offbox-BIND</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">external-listener-TCP</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Destination</strong></td>
<td>Host: 203.0.113.8</td>
</tr>
<tr class="row-odd"><td><strong>VLAN Traffic</strong></td>
<td>Enabled on..</td>
</tr>
<tr class="row-even"><td><strong>VLANs and Tunnels</strong></td>
<td>External</td>
</tr>
<tr class="row-odd"><td><strong>Protocol</strong></td>
<td>TCP</td>
</tr>
<tr class="row-even"><td><strong>DNS Profile</strong></td>
<td>AuthNS-offbox-BIND</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>For each Listener, click <strong>Finished</strong> to create.</li>
<li>You should now have two UDP-based DNS Listeners and two TCP-based
Listeners configured.</li>
</ul>
</div>
<div class="section" id="create-a-nameserver-for-hidden-master">
<h3>10.1.4. Create a Nameserver for Hidden Master<a class="headerlink" href="#create-a-nameserver-for-hidden-master" title="Permalink to this headline">¶</a></h3>
<p>We next need to tell GTM about our Hidden Master that DNS Express will
slave from.</p>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Nameservers &gt; Nameserver List: Create</strong></li>
<li>Create offbox-BIND as a Nameserver as shown in the table below.</li>
</ul>
<p><em>Keep the defaults if not noted in the table.</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="47%" />
<col width="53%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">Offbox-BIND</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Address</strong></td>
<td>203.0.113.15</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Click <strong>Finished</strong> to create.</li>
</ul>
</div>
<div class="section" id="create-a-zone-to-transfer-from-hidden-master">
<h3>10.1.5. Create a zone to transfer from Hidden Master<a class="headerlink" href="#create-a-zone-to-transfer-from-hidden-master" title="Permalink to this headline">¶</a></h3>
<p>We will now configure the specific zone for GTM to obtain from the
Hidden Master. Note that the BIND server already has some key
configuration elements to consider:</p>
<ul class="simple">
<li>“Allow-transfer” (for lab purposes, any sourceIP is allowed)</li>
<li>“Also-notify” for your internal Listener IP address.</li>
<li>TSIG is disabled.</li>
<li>Before we configure the zone, we are going to enable some debug
logging so that you can see what happens underneath the covers. SSH
to your F5 BIGIP1. You should have a BIGIP1 putty icon on your
desktop. Use username: <strong>root</strong> password: <strong>default</strong> and issue the
following TMSH command once logged in.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tmsh</span> <span class="n">modify</span> <span class="n">sys</span> <span class="n">db</span> <span class="n">log</span><span class="o">.</span><span class="n">zxfrd</span><span class="o">.</span><span class="n">level</span> <span class="n">value</span> <span class="s2">&quot;debug&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li>Now, view the log file real-time by issuing this command at the SSH prompt:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span>tail –f /var/log/ltm
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can make the putty window larger if needed</p>
</div>
<p>Keep your ssh session open while performing the rest of the steps.
You can break out of the tail process with <em>&lt;Ctrl-C&gt;</em>.</p>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Zones &gt; Zones &gt; Zone List: Create</strong></li>
<li>Create the <strong>“dnsx.com”</strong> zone as shown in the figure below and then
click <strong>Finished.</strong></li>
</ul>
<p><a class="reference internal" href="_images/image4.png"><img alt="image1" src="_images/image4.png" style="width: 3.93000in; height: 3.05000in;" /></a></p>
<ul class="simple">
<li>You should see log messages in your SSH console indicating a
successful transfer from the hidden master. You can also view the
state of the transfer by clicking back on the newly created zone and
observing the “Availability” as shown in the figure below.</li>
</ul>
<p><a class="reference internal" href="_images/image5.png"><img alt="image2" src="_images/image5.png" style="width: 2.66667in; height: 1.41319in;" /></a></p>
<ul class="simple">
<li>Issue the following command from SSH console to see specifics of the
status and statistics related to the zone.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tmsh</span> <span class="n">show</span> <span class="n">ltm</span> <span class="n">dns</span> <span class="n">zone</span> <span class="n">dnsx</span><span class="o">.</span><span class="n">com</span> <span class="o">|</span> <span class="n">more</span>
</pre></div>
</div>
<ul class="simple">
<li>The dnsx.com zone is configured with a 60 second refresh interval –
meaning that DNS Express will proactively check the Master Nameserver
every 60 seconds for zone updates. This very low interval is merely
for lab purposes so you can view what happens in the logs. The log
messages look like this:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Jun</span> <span class="mi">22</span> <span class="mi">14</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">38</span> <span class="n">gtm1</span> <span class="n">debug</span> <span class="n">zxfrd</span><span class="p">[</span><span class="mi">4251</span><span class="p">]:</span> <span class="mi">01531023</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span> <span class="n">Scheduling</span> <span class="n">zone</span> <span class="n">transfer</span> <span class="ow">in</span> <span class="mi">60</span><span class="n">s</span> <span class="k">for</span> <span class="n">dnsx</span><span class="o">.</span><span class="n">com</span> <span class="kn">from</span> <span class="mf">203.0</span><span class="o">.</span><span class="mf">113.15</span><span class="o">.</span>
<span class="n">Jun</span> <span class="mi">22</span> <span class="mi">14</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">38</span> <span class="n">gtm1</span> <span class="n">debug</span> <span class="n">zxfrd</span><span class="p">[</span><span class="mi">4251</span><span class="p">]:</span> <span class="mi">01531106</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span> <span class="n">Availability</span> <span class="n">status</span> <span class="n">of</span> <span class="n">dnsx</span><span class="o">.</span><span class="n">com</span> <span class="n">changed</span> <span class="kn">from</span> <span class="nn">YELLOW</span> <span class="n">to</span> <span class="n">GREEN</span><span class="o">.</span>
<span class="n">Jun</span> <span class="mi">22</span> <span class="mi">14</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">38</span> <span class="n">gtm1</span> <span class="n">debug</span> <span class="n">zxfrd</span><span class="p">[</span><span class="mi">4251</span><span class="p">]:</span> <span class="mi">01531025</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span> <span class="n">Serials</span> <span class="n">equal</span> <span class="p">(</span><span class="mi">2017062201</span><span class="p">);</span> <span class="n">transfer</span> <span class="k">for</span> <span class="n">zone</span> <span class="n">dnsx</span><span class="o">.</span><span class="n">com</span> <span class="n">complete</span><span class="o">.</span>
<span class="n">Jun</span> <span class="mi">22</span> <span class="mi">14</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">38</span> <span class="n">gtm1</span> <span class="n">debug</span> <span class="n">zxfrd</span><span class="p">[</span><span class="mi">4251</span><span class="p">]:</span> <span class="mi">01531008</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span> <span class="n">Resetting</span> <span class="n">transfer</span> <span class="n">state</span> <span class="k">for</span> <span class="n">zone</span> <span class="n">dnsx</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>
<span class="n">Jun</span> <span class="mi">22</span> <span class="mi">14</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">38</span> <span class="n">gtm1</span> <span class="n">debug</span> <span class="n">zxfrd</span><span class="p">[</span><span class="mi">4251</span><span class="p">]:</span> <span class="mi">01531023</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span> <span class="n">Scheduling</span> <span class="n">zone</span> <span class="n">transfer</span> <span class="ow">in</span> <span class="mi">60</span><span class="n">s</span> <span class="k">for</span> <span class="n">dnsx</span><span class="o">.</span><span class="n">com</span> <span class="kn">from</span> <span class="mf">203.0</span><span class="o">.</span><span class="mf">113.15</span><span class="o">.</span>
</pre></div>
</div>
<ul class="simple">
<li><dl class="first docutils">
<dt>Now, issue the following command in the SSH console to view what is</dt>
<dd>in DNS Express.</dd>
</dl>
</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dnsxdump</span> <span class="o">|</span> <span class="n">more</span>
</pre></div>
</div>
<ul class="simple">
<li>Open the command prompt from your windows desktop. Issue a DNS query
against your external listener for a record in the dnsx.com zone and
verify that it succeeds. For example:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">dig</span> <span class="nd">@203</span><span class="o">.</span><span class="mf">0.113</span><span class="o">.</span><span class="mi">8</span> <span class="o">+</span><span class="n">short</span> <span class="n">www1</span><span class="o">.</span><span class="n">dnsx</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<ul class="simple">
<li>Issue several more queries of different types to generate some
interesting statistics. Here are some examples:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dig</span> <span class="nd">@203</span><span class="o">.</span><span class="mf">0.113</span><span class="o">.</span><span class="mi">8</span> <span class="o">+</span><span class="n">short</span> <span class="n">www1</span><span class="o">.</span><span class="n">dnsx</span><span class="o">.</span><span class="n">com</span>

<span class="n">dig</span> <span class="nd">@203</span><span class="o">.</span><span class="mf">0.113</span><span class="o">.</span><span class="mi">8</span> <span class="o">+</span><span class="n">short</span> <span class="n">www2</span><span class="o">.</span><span class="n">dnsx</span><span class="o">.</span><span class="n">com</span>

<span class="n">dig</span> <span class="nd">@203</span><span class="o">.</span><span class="mf">0.113</span><span class="o">.</span><span class="mi">8</span> <span class="o">+</span><span class="n">short</span> <span class="n">www3</span><span class="o">.</span><span class="n">dnsx</span><span class="o">.</span><span class="n">com</span>

<span class="n">dig</span> <span class="nd">@203</span><span class="o">.</span><span class="mf">0.113</span><span class="o">.</span><span class="mi">8</span> <span class="o">+</span><span class="n">short</span> <span class="n">bigip1</span><span class="o">.</span><span class="n">dnsx</span><span class="o">.</span><span class="n">com</span>

<span class="n">dig</span> <span class="nd">@203</span><span class="o">.</span><span class="mf">0.113</span><span class="o">.</span><span class="mi">8</span> <span class="o">+</span><span class="n">short</span> <span class="n">bigip2</span><span class="o">.</span><span class="n">dnsx</span><span class="o">.</span><span class="n">com</span>

<span class="n">dig</span> <span class="nd">@203</span><span class="o">.</span><span class="mf">0.113</span><span class="o">.</span><span class="mi">8</span> <span class="o">+</span><span class="n">short</span> <span class="n">MX</span> <span class="n">dnsx</span><span class="o">.</span><span class="n">com</span>

<span class="n">dig</span> <span class="nd">@203</span><span class="o">.</span><span class="mf">0.113</span><span class="o">.</span><span class="mi">8</span> <span class="o">+</span><span class="n">short</span> <span class="n">NS</span> <span class="n">dnsx</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<ul class="simple">
<li>Now is a good time to check query logging. Look at <a href="#id1"><span class="problematic" id="id2">``</span></a>/var/log/ltm <a href="#id3"><span class="problematic" id="id4">``</span></a>(i.e.
tail /var/log/ltm ) to ensure that you’re properly logging queries
and responses. It should look something like this:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Jun</span> <span class="mi">22</span> <span class="mi">14</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">14</span> <span class="n">gtm1</span> <span class="n">info</span> <span class="n">tmm</span><span class="p">[</span><span class="mi">10506</span><span class="p">]:</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">22</span> <span class="mi">14</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">14</span> <span class="n">gtm1</span><span class="o">.</span><span class="n">site1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> <span class="n">qid</span> <span class="mi">340</span> <span class="kn">from</span> <span class="mf">203.0</span><span class="o">.</span><span class="mf">113.1</span><span class="c1">#50316: view none: query: www3.dnsx.com IN A + (203.0.113.8%0)</span>
<span class="n">Jun</span> <span class="mi">22</span> <span class="mi">14</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">14</span> <span class="n">gtm1</span> <span class="n">info</span> <span class="n">tmm</span><span class="p">[</span><span class="mi">10506</span><span class="p">]:</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">22</span> <span class="mi">14</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">14</span> <span class="n">gtm1</span><span class="o">.</span><span class="n">site1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> <span class="n">qid</span> <span class="mi">340</span> <span class="n">to</span> <span class="mf">203.0</span><span class="o">.</span><span class="mf">113.1</span><span class="c1">#50316: [NOERROR qr,aa,rd] response: www3.dnsx.com. 100 IN A 203.0.113.103;</span>
</pre></div>
</div>
<ul class="simple">
<li>In the GUI, navigate to <strong>Statistics &gt; Analytics &gt; DNS</strong>. Notice that
you can view statics by different data points, over different periods of
time, and drill down into different aspects. Spend a few moments looking
at the various options.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This may take up to 5 minutes to populate.</p>
</div>
<p>If no data exists, come back after the next task.</p>
</div>
<div class="section" id="enable-dnssec-for-the-zone">
<h3>10.1.6. Enable DNSSEC for the zone<a class="headerlink" href="#enable-dnssec-for-the-zone" title="Permalink to this headline">¶</a></h3>
<p>We will now sign the dnsx.com zone. In this example, we are configuring
GTM to sign the zone on the fly rather than signing the actual static
zone information (which can be done starting in v11.5 but is outside the
scope of this lab).</p>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Keys &gt; DNSSEC Key List: Create</strong></li>
<li>Create two keys as defined in the tables below.</li>
</ul>
<p><em>Keep the defaults if not noted in the table.</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="52%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">dnsx.com_zsk</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Type</strong></td>
<td>Zone Signing Key</td>
</tr>
<tr class="row-odd"><td><strong>Key Management</strong></td>
<td>Manual</td>
</tr>
<tr class="row-even"><td><strong>Certificate</strong></td>
<td>default.crt</td>
</tr>
<tr class="row-odd"><td><strong>Private Key</strong></td>
<td>default.key</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="54%" />
<col width="46%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">dnsx.com_ksk</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Type</strong></td>
<td>Key Signing Key</td>
</tr>
<tr class="row-odd"><td><strong>Key Management</strong></td>
<td>Manual</td>
</tr>
<tr class="row-even"><td><strong>Certificate</strong></td>
<td>default.crt</td>
</tr>
<tr class="row-odd"><td><strong>Private Key</strong></td>
<td>default.key</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Click <strong>Finished</strong> to create each key.</li>
<li>In the GUI, navigate to: <strong>DNS &gt; Zones &gt; DNSSEC Zones &gt; DNSSEC Zone List: Create</strong></li>
<li>Configure the dnsx.com zone for DNSSEC using the previously created
keys as shown below.</li>
</ul>
<p><a class="reference internal" href="_images/image6.png"><img alt="image3" src="_images/image6.png" style="width: 3.23729in; height: 2.35556in;" /></a></p>
<ul class="simple">
<li>Test that the zone is successfully signed by issuing a DNSSEC query
to the external listener. For example:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dig</span> <span class="nd">@203</span><span class="o">.</span><span class="mf">0.113</span><span class="o">.</span><span class="mi">8</span> <span class="o">+</span><span class="n">dnssec</span> <span class="n">www1</span><span class="o">.</span><span class="n">dnsx</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<p>You should see RRSIG records indicating that the zone is signed. You
will also note signing in the query logs (<code class="docutils literal"><span class="pre">/var/log/ltm</span></code>)</p>
<ul class="simple">
<li>Finally, view some other DNS statistics related to queries, DNSSEC, zone transfers, notifies, etc.</li>
<li>In the GUI, navigate to: <strong>DNS &gt; Zone &gt; Zones &gt; Zone List.</strong></li>
<li>Click on the “dnsx.com” zone and then select “Statistics” from the top menu bar.</li>
<li>Select the “View” Details as shown in the diagram below:</li>
</ul>
<p><a class="reference internal" href="_images/image7.png"><img alt="image4" src="_images/image7.png" style="width: 3.96000in; height: 1.71000in;" /></a></p>
<ul class="simple">
<li>View the types of statistics available for the zone such as serial number, number of records, etc.</li>
<li>In the GUI, navigate to: <strong>Statistics &gt; Module Statistics &gt; DNS &gt; Zones</strong>.</li>
<li>Set “Statistics Type” to <strong>“DNSSEC Zones”.</strong></li>
<li>View details as performed above. Note the various DNSSEC statistics available.</li>
<li>If the graphs from task 5 weren’t available earlier, revisit
<strong>Statistics &gt; Analytics &gt; DNS</strong> now and explore.</li>
</ul>
</div>
</div>
<div class="section" id="authoritative-name-server-slave-from-on-box-bind">
<h2>10.2. Authoritative Name Server: slave from ON-BOX BIND<a class="headerlink" href="#authoritative-name-server-slave-from-on-box-bind" title="Permalink to this headline">¶</a></h2>
<p>In this use-case, you will configure GTM as an authoritative slave
using on-box BIND managed by ZoneRunner.</p>
<p>Estimated completion time: 15 minutes</p>
<div class="section" id="id5">
<h3>10.2.1. Create a new DNS Profile<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Profiles &gt; DNS: Create.</strong>
Create a new DNS profile as shown in the table below.</li>
</ul>
<p><em>Keep the defaults if not noted in the table.</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="53%" />
<col width="47%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">AuthNS-onbox-BIND</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Unhandled Query Action</strong></td>
<td>Drop</td>
</tr>
<tr class="row-odd"><td><strong>Use BIND Server on Big-IP</strong></td>
<td>Disabled</td>
</tr>
<tr class="row-even"><td><strong>Logging</strong></td>
<td>Enabled</td>
</tr>
<tr class="row-odd"><td><strong>Logging Profile</strong></td>
<td>dns-logging</td>
</tr>
<tr class="row-even"><td><strong>AVR Statistics Sampling Rate</strong></td>
<td>Enabled; 1/1 queries sampled</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Click <strong>Finished</strong> to create.</li>
</ul>
<p>For lab purposes, we are going to sample all DNS queries with AVR.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Production sampling rates would be a much lower rate.</p>
</div>
</div>
<div class="section" id="edit-dns-listeners">
<h3>10.2.2. Edit DNS Listeners<a class="headerlink" href="#edit-dns-listeners" title="Permalink to this headline">¶</a></h3>
<p>We need to edit the external-listeners to use the new DNS profile
created above.</p>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Listeners &gt; Listener List</strong></li>
<li>Edit the external-listener-UDP to use the AuthNS-onbox-BIND DNS
profile.</li>
<li>Edit the external-listener-TCP to use the AuthNS-onbox-BIND DNS
profile.</li>
<li>Click <strong>Update</strong> after change DNS profile to finish edition.</li>
</ul>
</div>
<div class="section" id="create-a-student1-com-zone-using-zonerunner">
<h3>10.2.3. Create a Student1.com zone using ZoneRunner<a class="headerlink" href="#create-a-student1-com-zone-using-zonerunner" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Zones: ZoneRunner &gt; Zone List: Create</strong></li>
<li>Add a student1.com zone with the information as shown in the
following screenshot. Note the “also-notify” message needs to be
added to send a NOTIFY message to an internal GTM IP address for
processing. Likewise BIND needs to allow the transfer from the
loopback address. The diagram below shows the basic operation.</li>
</ul>
<p><a class="reference internal" href="_images/image8.png"><img alt="image5" src="_images/image8.png" style="width: 3.13333in; height: 1.40000in;" /></a></p>
<p><a class="reference internal" href="_images/image9.png"><img alt="image6" src="_images/image9.png" style="width: 5.31042in; height: 6.32847in;" /></a></p>
</div>
<div class="section" id="create-a-nameserver-for-on-box-bind">
<h3>10.2.4. Create a Nameserver for on-box BIND<a class="headerlink" href="#create-a-nameserver-for-on-box-bind" title="Permalink to this headline">¶</a></h3>
<p>Next, we need to tell DNS Express that on-box BIND is available to use
as a source for zone transfers.</p>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Nameservers &gt; Nameserver List: Create</strong></li>
<li>Create a loopback as a Nameserver as shown in the table below.</li>
</ul>
<p><em>Keep the defaults if not noted in the table.</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="52%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">ZoneRunner</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Address</strong></td>
<td>127.0.0.1</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Click <strong>Finished</strong> to create.</li>
</ul>
</div>
<div class="section" id="create-a-dns-express-zone-to-transfer-from-zonerunner">
<h3>10.2.5. Create a DNS Express zone to transfer from ZoneRunner<a class="headerlink" href="#create-a-dns-express-zone-to-transfer-from-zonerunner" title="Permalink to this headline">¶</a></h3>
<p>We will now configure the specific zone for GTM to obtain from
ZoneRunner. Note that on-box BIND already has some key configuration
elements to consider:</p>
<blockquote>
<div><ul class="simple">
<li>“Allow-transfer” from the localhost.</li>
<li>“Also-notify” for DNS Express internal Listener IP address.</li>
<li>TSIG is disabled.</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Zones &gt; Zones &gt; Zone List: Create</strong></li>
<li>Create the “student1.com” zone as shown in the figure below and then
click <strong>Finished.</strong></li>
</ul>
<p><a class="reference internal" href="_images/image10.png"><img alt="image7" src="_images/image10.png" style="width: 4.03000in; height: 3.21000in;" /></a></p>
<ul class="simple">
<li>Perform the same validation steps as the previous lab for validating
the successful transfer of student1.com to DNS Express</li>
<li>View the details of the zone in the GUI</li>
<li>Issue the following command from the ssh console:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tmsh</span> <span class="n">show</span> <span class="n">ltm</span> <span class="n">dns</span> <span class="n">zone</span> <span class="n">student1</span><span class="o">.</span><span class="n">com</span> <span class="o">|</span> <span class="n">more</span>
</pre></div>
</div>
<ul class="simple">
<li>Dump the dns express output to see the records</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dnsxdump</span> <span class="o">|</span> <span class="n">more</span>
</pre></div>
</div>
<ul class="simple">
<li>Verify logs in <code class="docutils literal"><span class="pre">/var/log/ltm</span></code></li>
<li>From a command prompt on your jumpbox, issue a query to the external
listener for a record in the zone</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dig</span> <span class="nd">@203</span><span class="o">.</span><span class="mf">0.113</span><span class="o">.</span><span class="mi">8</span> <span class="n">SOA</span> <span class="n">student1</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<ul class="simple">
<li>Add a new record to the Student1.com zone in ZoneRunner</li>
<li>In the GUI, navigate to: <strong>DNS &gt; Zones: ZoneRunner &gt; Resource Record List.</strong></li>
<li>Select View Name -&gt; external</li>
<li>Select Zone Name -&gt; student1.com.</li>
<li>Click <strong>Create</strong></li>
<li>Enter a new A record similar to the figure below for your zone and
click <strong>Finished</strong>.</li>
</ul>
<p><a class="reference internal" href="_images/image11.png"><img alt="image8" src="_images/image11.png" style="width: 3.95000in; height: 2.51000in;" /></a></p>
<ul class="simple">
<li>Validate the DNS Express was updated by performing a dnsxdump and/or
query for your new record to the Listener.</li>
<li>Add another record using the steps above for <strong>www2.student1.com</strong>
with IP address of <strong>203.0.113.102</strong> but before doing this, make sure to
have a putty session open to your BIG-IP1 and tail the logs using
<code class="docutils literal"><span class="pre">tail</span> <span class="pre">–f</span> <span class="pre">/var/log/ltm</span></code> to view the changes. By making a change to the
zone on the Hidden Master (in this case ZoneRunner), you will see a
proactive update to DNS Express via a NOTIFY. Watch the <code class="docutils literal"><span class="pre">/var/log/ltm</span></code>
file to see the update occur. The logs should look something like
this:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Jun</span> <span class="mi">5</span> <span class="mi">08</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">26</span> <span class="n">bigip1</span> <span class="n">notice</span> <span class="n">zxfrd</span><span class="p">[</span><span class="mi">6429</span><span class="p">]:</span> <span class="mi">0153101</span><span class="n">c</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span> <span class="n">Handling</span> <span class="n">NOTIFY</span> <span class="k">for</span> <span class="n">zone</span> <span class="n">student1</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>
<span class="n">Jun</span> <span class="mi">5</span> <span class="mi">08</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">26</span> <span class="n">bigip1</span> <span class="n">debug</span> <span class="n">zxfrd</span><span class="p">[</span><span class="mi">6429</span><span class="p">]:</span> <span class="mi">01531008</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span> <span class="n">Resetting</span> <span class="n">transfer</span> <span class="n">state</span> <span class="k">for</span> <span class="n">zone</span> <span class="n">student1</span><span class="o">.</span><span class="n">com</span><span class="o">.</span>
<span class="n">Jun</span> <span class="mi">5</span> <span class="mi">08</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">26</span> <span class="n">bigip1</span> <span class="n">debug</span> <span class="n">zxfrd</span><span class="p">[</span><span class="mi">6429</span><span class="p">]:</span> <span class="mi">01531023</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span> <span class="n">Scheduling</span> <span class="n">zone</span> <span class="n">transfer</span> <span class="ow">in</span> <span class="mi">5</span><span class="n">s</span> <span class="k">for</span> <span class="n">student1</span><span class="o">.</span><span class="n">com</span> <span class="kn">from</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="o">.</span>
<span class="n">Jun</span> <span class="mi">5</span> <span class="mi">08</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">26</span> <span class="n">bigip1</span> <span class="n">debug</span> <span class="n">zxfrd</span><span class="p">[</span><span class="mi">6429</span><span class="p">]:</span> <span class="mi">01531027</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span> <span class="n">Notify</span> <span class="n">response</span> <span class="n">to</span> <span class="p">::</span><span class="mi">1</span> <span class="n">succeeded</span> <span class="p">(</span><span class="mi">81</span><span class="p">:</span><span class="n">na</span><span class="p">)</span><span class="o">.</span>
<span class="n">Jun</span> <span class="mi">5</span> <span class="mi">08</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">31</span> <span class="n">bigip1</span> <span class="n">notice</span> <span class="n">zxfrd</span><span class="p">[</span><span class="mi">6429</span><span class="p">]:</span> <span class="mi">0153101</span><span class="n">f</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span> <span class="n">IXFR</span> <span class="n">Transfer</span> <span class="n">of</span> <span class="n">zone</span> <span class="n">student1</span><span class="o">.</span><span class="n">com</span> <span class="kn">from</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="n">succeeded</span><span class="o">.</span>
</pre></div>
</div>
<p>Issue a <code class="docutils literal"><span class="pre">dnsxdump</span> <span class="pre">|</span> <span class="pre">more</span></code> command for the SSH console or a query to the
listener to validate the zone file has updated.</p>
</div>
</div>
<div class="section" id="slaving-off-of-dns-express">
<h2>10.3. Slaving off of DNS Express<a class="headerlink" href="#slaving-off-of-dns-express" title="Permalink to this headline">¶</a></h2>
<p>In this use-case, we will obtain a zone transfer from another F5’s
DNS Express. This is a common deployment in a hybrid on-premise and
cloud-based DNS solution. Our purpose here is to focus on DNS Express
serving zone transfer clients. Note that zones can be signed during a
transfer – but this is outside the scope of this lab</p>
<ul class="simple">
<li>Estimated completion time: 10 minutes</li>
</ul>
<div class="section" id="id6">
<h3>10.3.1. Create a new DNS Profile<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Profiles &gt; DNS: Create.</strong>
Create a new DNS profile as shown in the table below.</li>
</ul>
<p><em>Keep the defaults if not noted in the table.</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="53%" />
<col width="47%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">AuthNS-hybrid</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Unhandled Query Action</strong></td>
<td>Drop</td>
</tr>
<tr class="row-odd"><td><strong>Use BIND Server on Big-IP</strong></td>
<td>Disabled</td>
</tr>
<tr class="row-even"><td><strong>Zone Transfer</strong></td>
<td>Enabled</td>
</tr>
<tr class="row-odd"><td><strong>Logging</strong></td>
<td>Enabled</td>
</tr>
<tr class="row-even"><td><strong>Logging Profile</strong></td>
<td>dns-logging</td>
</tr>
<tr class="row-odd"><td><strong>AVR Statistics Sampling Rate</strong></td>
<td>Enabled; 1/1 queries sampled</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>For lab purposes, we are going to use sample all DNS queries with
AVR.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">that production sampling rates would be a much lower rate.</p>
</div>
</div>
<div class="section" id="id7">
<h3>10.3.2. Edit DNS Listeners<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Listeners &gt; Listener List</strong></li>
<li>Edit the external-listener-TCP to use the AuthNS-hybrid DNS profile.</li>
<li>Click <strong>Update</strong> to finish.</li>
</ul>
</div>
<div class="section" id="create-nameservers-for-zone-transfer-clients">
<h3>10.3.3. Create Nameservers for Zone Transfer Clients<a class="headerlink" href="#create-nameservers-for-zone-transfer-clients" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Your lab environment has a second pre-configured BIG-IP (BIGIP2) that
we will use as the on-prem DNS Express Master.</li>
<li>In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Nameservers &gt; Nameserver List: Create</strong></li>
<li>Create BIGIP2’s F5 as a Nameserver as shown in the table below. You
will use the External SelfIP/Listener.</li>
</ul>
<p><em>Keep the defaults if not noted in the table.</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="45%" />
<col width="55%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">site2_gtm1_master</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Address</strong></td>
<td>198.51.100.39</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="edit-student2-zones-on-bigip2-to-allow-zone-transfers">
<h3>10.3.4. Edit Student2 Zones on BIGIP2 to allow Zone transfers<a class="headerlink" href="#edit-student2-zones-on-bigip2-to-allow-zone-transfers" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Log in to gtm1.site2 (shortcut located on desktop) using a new browser
window with the following credentials:</li>
<li><a class="reference external" href="https://10.1.10.23">https://10.1.10.23</a></li>
<li>User: <em>admin</em> Pass: <em>admin</em></li>
<li>In the GUI, navigate to: <strong>DNS &gt; Zones &gt; Zones &gt; Zone List</strong></li>
<li>Edit the existing student2.com zone.</li>
<li>Under Zone Transfer Clients, move <strong>gtm1.site1</strong> (pre-defined to save
time) to Active and click <strong>Update</strong>.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The internal TCP listener on BIGIP2 is using the
AuthNS-hybrid profile which is setup exactly like the profile with
the same name on BIGIP1. ‘Zone Transfer = Enabled’ must be set in the
profile on the source for this to work correctly.</p>
</div>
<ul class="simple">
<li>Return to your BIGIP1 browser session</li>
</ul>
</div>
<div class="section" id="add-student2-com-zone-to-dns-express-on-bigip1">
<h3>10.3.5. Add Student2.com zone to DNS Express on BIGIP1<a class="headerlink" href="#add-student2-com-zone-to-dns-express-on-bigip1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>In the GUI on BIGIP1, navigate to: <strong>DNS &gt; Zones &gt; Zones &gt; Zone List: Create</strong></li>
<li>Create the “student2.com” zone as shown in the figure below and then
click Finished. Your GTM is acting as a zone transfer client in this
case (looking to receive a transfer of the on-prem student2.com local
zone). This example shows BIGIP1 adding the student2.com zone to pull
from DNS Express on BIGIP2.</li>
</ul>
<p><a class="reference internal" href="_images/image12.png"><img alt="image9" src="_images/image12.png" style="width: 3.95000in; height: 2.97000in;" /></a></p>
<ul class="simple">
<li>Perform the same validation steps as the previous lab for validating
the successful transfer of student2.com zone</li>
<li>View the details of the zone in the GUI</li>
<li>Issue a <code class="docutils literal"><span class="pre">dnsxdump</span> <span class="pre">|</span> <span class="pre">more</span></code> command from SSH console</li>
<li>Verify logs in <code class="docutils literal"><span class="pre">/var/log/ltm</span></code></li>
<li>Issue a query to the external listener for a record in the zone</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dig</span> <span class="nd">@203</span><span class="o">.</span><span class="mf">0.113</span><span class="o">.</span><span class="mi">8</span> <span class="n">SOA</span> <span class="n">student2</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<ul class="simple">
<li>Open putty sessions to both BIGIP1 and BIGIP2 and tail the logs using
<code class="docutils literal"><span class="pre">tail</span> <span class="pre">–f</span> <span class="pre">/var/log/ltm</span></code>. This will allow us to see the process of
adding a new record on the Master on-prem server (BIGIP2) and then it
being replicated first to DNS Express on its own box, followed by an
update to the cloud GTM (BIGIP1) in this scenario.</li>
<li>Add a new record to the student2.com zone in ZoneRunner on <strong>gtm1.site2</strong></li>
<li>In the GUI, navigate to: <strong>DNS &gt; Zones: ZoneRunner &gt; Resource Record List</strong></li>
<li>Select View Name -&gt; external</li>
<li>Select Zone Name -&gt; student2.com.</li>
<li>Click <strong>Create</strong></li>
<li>Enter a new A record based on the picture below and click
<strong>Finished</strong>.</li>
</ul>
<p><a class="reference internal" href="_images/image13.png"><img alt="image10" src="_images/image13.png" style="width: 3.64000in; height: 2.46000in;" /></a></p>
<ul class="simple">
<li>Notice the logs in each F5. You will see BIGIP2 perform a zone transfer
from ZR after receiving a NOTIFY. You will then see BIGIP1
receive a NOTIFY and obtain a zone transfer.</li>
<li>Notice that we didn’t have to tell GTM where to send a NOTIFY. Those
messages are automatically sent to the Zone Transfer Clients
configured for the zone.</li>
<li>Issue the following command from SSH console on BIGIP1 to see the
status and statistics related to the zone.
<em>Take note of the “Notifies Received” counter.</em></li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tmsh</span> <span class="n">show</span> <span class="n">ltm</span> <span class="n">dns</span> <span class="n">zone</span> <span class="n">student2</span><span class="o">.</span><span class="n">com</span> <span class="o">|</span> <span class="n">more</span>
</pre></div>
</div>
<ul class="simple">
<li>Issue the following command from SSH console on BIGIP2 to see the
status and statistics related to the zone.
<em>Take note of the “Notifies To Client” counter.</em></li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tmsh</span> <span class="n">show</span> <span class="n">ltm</span> <span class="n">dns</span> <span class="n">zone</span> <span class="n">student2</span><span class="o">.</span><span class="n">com</span> <span class="o">|</span> <span class="n">more</span>
</pre></div>
</div>
<ul class="simple">
<li>Validate DNS Express was updated by performing a <code class="docutils literal"><span class="pre">dnsxdump</span> <span class="pre">|</span> <span class="pre">more</span></code>
and/or query for your new record to the Listener.</li>
</ul>
<p><strong>Close out your browser session to gtm1.site2, we will no longer be using it.</strong></p>
</div>
</div>
<div class="section" id="transparent-caching">
<h2>10.4. Transparent Caching<a class="headerlink" href="#transparent-caching" title="Permalink to this headline">¶</a></h2>
<p>In this use-case, you will configure GTM as a transparent cache to a pool of BIND servers.</p>
<ul class="simple">
<li>Estimated completion time: 10 minutes</li>
</ul>
<p><a class="reference internal" href="_images/image14.png"><img alt="image11" src="_images/image14.png" style="width: 4.25347in; height: 3.55347in;" /></a></p>
<div class="section" id="create-a-dns-cache">
<h3>10.4.1. Create a DNS Cache<a class="headerlink" href="#create-a-dns-cache" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Caches &gt; Cache List: Create</strong></li>
<li>Create a new DNS profile as shown in the table below.</li>
</ul>
<p><em>Keep the defaults if not noted in the table.</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="49%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">transparent-cache</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Resolver Type</strong></td>
<td>Transparent (none)</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Click <strong>Finished</strong> to create.</li>
</ul>
</div>
<div class="section" id="id8">
<h3>10.4.2. Create a new DNS Profile<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Profiles &gt; DNS: Create</strong>.
Create a new DNS profile as shown in the table below.</li>
</ul>
<p><em>Keep the defaults if not noted in the table.</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">Transparent</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>DNSSEC</strong></td>
<td>Disabled</td>
</tr>
<tr class="row-odd"><td><strong>GSLB</strong></td>
<td>Disabled</td>
</tr>
<tr class="row-even"><td><strong>DNS Express</strong></td>
<td>Disabled</td>
</tr>
<tr class="row-odd"><td><strong>DNS Cache</strong></td>
<td>Enabled</td>
</tr>
<tr class="row-even"><td><strong>DNS Cache Name</strong></td>
<td>transparent-cache</td>
</tr>
<tr class="row-odd"><td><strong>Use BIND Server on Big-IP</strong></td>
<td>Disabled</td>
</tr>
<tr class="row-even"><td><strong>Logging</strong></td>
<td>Enabled</td>
</tr>
<tr class="row-odd"><td><strong>Logging Profile</strong></td>
<td>dns-logging //from previous lab</td>
</tr>
<tr class="row-even"><td><strong>AVR Statistics Sampling Rate</strong></td>
<td>Enabled; 1/1 queries sampled</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="create-a-dns-monitor">
<h3>10.4.3. Create a DNS Monitor<a class="headerlink" href="#create-a-dns-monitor" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Load Balancing &gt; Monitors: Create</strong>.
Create a new DNS monitor as shown in the table below.</li>
</ul>
<p><em>Keep the defaults if not noted in the table.</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">mon_resolver</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Type</strong></td>
<td>DNS</td>
</tr>
<tr class="row-odd"><td><strong>Query Name</strong></td>
<td><a class="reference external" href="http://www.f5.com">www.f5.com</a></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Click <strong>Finished</strong> to create.</li>
</ul>
</div>
<div class="section" id="create-a-resolver-pool">
<h3>10.4.4. Create a Resolver Pool<a class="headerlink" href="#create-a-resolver-pool" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Load Balancing &gt; Pools &gt; Pools List: Create</strong>.
Create a new pool of DNS resolvers as shown in the figure below.</li>
<li>Add pool called <strong>pool_resolvers</strong> with health monitor
(<strong>mon_resolver</strong>) and members as shown in table and diagram below:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Pool Members</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>10.128.20.101:53</td>
</tr>
<tr class="row-odd"><td>10.128.20.102:53</td>
</tr>
<tr class="row-even"><td>10.128.20.103:53</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="_images/image15.png"><img alt="image12" src="_images/image15.png" style="width: 4.24000in; height: 4.25000in;" /></a></p>
</div>
<div class="section" id="create-a-new-external-dns-listener">
<h3>10.4.5. Create a new External DNS Listener<a class="headerlink" href="#create-a-new-external-dns-listener" title="Permalink to this headline">¶</a></h3>
<p>We are going to create a new external-facing DNS Listener to cache DNS
requests and load-balance non-cached requests to pool_resolvers.</p>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Listeners &gt; Listener List: Create</strong></li>
<li>Create a Listener named ‘<strong>resolver-listener</strong>’ as shown in the
figure below. Use the Listener IP of <a href="#id9"><span class="problematic" id="id10">**</span></a>10.128.10.54</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">you need to be in the “Advanced” Menu to set some of the options.</p>
</div>
<p><a class="reference internal" href="_images/image16.png"><img alt="image13" src="_images/image16.png" style="width: 4.71000in; height: 6.97000in;" /></a></p>
<ul class="simple">
<li>From your workstation at a command prompt, perform several recursive
queries to your new listener to test. You will want to repeat some of the same queries multiple times
We are attempting to see cache hits. Below are some examples:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dig</span> <span class="nd">@10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">54</span> <span class="n">www</span><span class="o">.</span><span class="n">f5</span><span class="o">.</span><span class="n">com</span>
<span class="n">dig</span> <span class="nd">@10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">54</span> <span class="n">www</span><span class="o">.</span><span class="n">wikipedia</span><span class="o">.</span><span class="n">org</span>
<span class="n">dig</span> <span class="nd">@10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">54</span> <span class="n">www</span><span class="o">.</span><span class="n">ncsu</span><span class="o">.</span><span class="n">edu</span>
</pre></div>
</div>
<ul class="simple">
<li>You should have successful resolution. Now it’s time to see statistics and cache entries.</li>
</ul>
<p><strong>Viewing Cache Entries</strong></p>
<ul class="simple">
<li>In the SSH shell, type the following command:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tmsh</span> <span class="n">show</span> <span class="n">ltm</span> <span class="n">dns</span> <span class="n">cache</span> <span class="n">records</span> <span class="n">rrset</span> <span class="n">cache</span> <span class="n">transparent</span><span class="o">-</span><span class="n">cache</span>
</pre></div>
</div>
<ul class="simple">
<li>Your output should look similar to below with several entries</li>
</ul>
<p><a class="reference internal" href="_images/image17.png"><img alt="image14" src="_images/image17.png" style="width: 5.46000in; height: 2.55000in;" /></a></p>
<ul class="simple">
<li>If you go to the TMSH console, you can see several other ways to
query the cache database. Below show some examples.</li>
<li>View cache entries for a particular domain / owner:</li>
</ul>
<p><a class="reference internal" href="_images/image18.png"><img alt="image15" src="_images/image18.png" style="width: 5.46000in; height: 1.54000in;" /></a></p>
<ul class="simple">
<li>View cache entries of a particular RR type:</li>
</ul>
<p><a class="reference internal" href="_images/image19.png"><img alt="image16" src="_images/image19.png" style="width: 5.46000in; height: 1.95000in;" /></a></p>
<ul class="simple">
<li>There are other options… feel free to play around and familiarize
yourself with the options.</li>
</ul>
<p><strong>Viewing Cache Statistics</strong></p>
<ul class="simple">
<li>In the SSH shell, type:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tmsh</span> <span class="n">show</span> <span class="n">ltm</span> <span class="n">dns</span> <span class="n">cache</span> <span class="n">transparent</span> <span class="n">transparent</span><span class="o">-</span><span class="n">cache</span>
</pre></div>
</div>
<ul class="simple">
<li>Your output should look similar to below with statistics showing Hits
and Misses in particular.</li>
</ul>
<p><a class="reference internal" href="_images/image20.png"><img alt="image17" src="_images/image20.png" style="width: 5.45000in; height: 3.26000in;" /></a></p>
<ul class="simple">
<li>In the GUI, you can find similar data as above by navigating
<strong>Statistics &gt; Module Statistics &gt; DNS &gt; Caches</strong>.</li>
<li>Select “Statistics Type” of Caches.</li>
<li>Select “View” under the Details column for transparent-cache</li>
<li>Note that stats can also be reset from this view (Reset).</li>
</ul>
<p><a class="reference internal" href="_images/image21.png"><img alt="image18" src="_images/image21.png" style="width: 3.86667in; height: 2.92014in;" /></a></p>
<ul class="simple">
<li>Spend some time looking in the DNS Analytics to verify that AVR is
graphing query stats as expected.</li>
</ul>
<p><strong>Deleting Cache Entries</strong></p>
<ul class="simple">
<li>Specific cache entries can be deleted via the TMSH console. Entries
to be deleted can be filtered by several aspects.</li>
<li>In the TMSH shell, go to the DNS prompt and type</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span>delete cache records rrset cache transparent-cache ?
</pre></div>
</div>
<ul class="simple">
<li>Now delete individual records by type and owner. Below show some
examples.</li>
</ul>
<p><a class="reference internal" href="_images/image22.png"><img alt="image19" src="_images/image22.png" style="width: 5.87000in; height: 3.78000in;" /></a></p>
<p><strong>Clearing Entire Cache</strong></p>
<ul class="simple">
<li>Via the GUI, navigate to <strong>Statistics &gt; Module Statistics &gt; DNS &gt; Caches</strong></li>
<li>Set “Statistics Type” to “Caches”.</li>
<li>You can select the cache and click “Clear Cache” to empty the cache.</li>
</ul>
</div>
</div>
<div class="section" id="resolver-cache">
<h2>10.5. Resolver Cache<a class="headerlink" href="#resolver-cache" title="Permalink to this headline">¶</a></h2>
<p>In this use case, you will configure GTM as a resolver cache which
eliminates the need for the pool of resolvers.
* Estimated completion time: 10 minutes</p>
<p><a class="reference internal" href="_images/image23.png"><img alt="image20" src="_images/image23.png" style="width: 4.58264in; height: 2.95764in;" /></a></p>
<div class="section" id="create-a-new-dns-cache">
<h3>10.5.1. Create a new DNS Cache<a class="headerlink" href="#create-a-new-dns-cache" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Caches &gt; Cache List: Create</strong></li>
<li>Create a new DNS Cache as shown in the table below.</li>
</ul>
<p><em>Keep the defaults if not noted in the table.</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="54%" />
<col width="46%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">resolver-cache</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Resolver Type</strong></td>
<td>Resolver</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id11">
<h3>10.5.2. Create a new DNS Profile<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Profiles &gt; DNS: Create</strong>.
Create a new DNS profile as shown in the table below.</li>
</ul>
<p><em>Keep the defaults if not noted in the table.</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">Resolver</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>DNSSEC</strong></td>
<td>Disabled</td>
</tr>
<tr class="row-odd"><td><strong>GSLB</strong></td>
<td>Disabled</td>
</tr>
<tr class="row-even"><td><strong>DNS Express</strong></td>
<td>Disabled</td>
</tr>
<tr class="row-odd"><td><strong>DNS Cache</strong></td>
<td>Enabled</td>
</tr>
<tr class="row-even"><td><strong>DNS Cache Name</strong></td>
<td>resolver-cache</td>
</tr>
<tr class="row-odd"><td><strong>Unhandled Query Action</strong></td>
<td>Drop</td>
</tr>
<tr class="row-even"><td><strong>Use BIND Server on Big-IP</strong></td>
<td>Disabled</td>
</tr>
<tr class="row-odd"><td><strong>Logging</strong></td>
<td>Enabled</td>
</tr>
<tr class="row-even"><td><strong>Logging Profile</strong></td>
<td>dns-logging //from previous lab</td>
</tr>
<tr class="row-odd"><td><strong>AVR Statistics Sampling Rate</strong></td>
<td>Enabled; 1/1 queries sampled</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="edit-dns-listener">
<h3>10.5.3. Edit DNS Listener<a class="headerlink" href="#edit-dns-listener" title="Permalink to this headline">¶</a></h3>
<p>We will now apply the new profile to the existing DNS Listener.</p>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Listeners &gt; Listener List</strong></li>
<li>Select ‘resolver-listener’ and modify the following settings.</li>
<li>Change the DNS profile to ‘resolver’ and uncheck “Address
Translation” (under Listener Advanced options). Click <strong>Update</strong>.</li>
<li>Select “Load Balancing” from the middle menu above, and Select the
Default Pool as “None” and click <strong>Update</strong>.</li>
<li>Your Listener should now be setup as a caching resolver.</li>
<li>From your workstation command prompt, perform several recursive
queries to your external Listener to test. You will want to repeat
some of the same queries multiple times. We are attempting to see
cache hits and perform recursive queries. Below are some examples:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dig</span> <span class="nd">@10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">54</span> <span class="n">www</span><span class="o">.</span><span class="n">cnn</span><span class="o">.</span><span class="n">com</span>

<span class="n">dig</span> <span class="nd">@10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">54</span> <span class="n">www</span><span class="o">.</span><span class="n">google</span><span class="o">.</span><span class="n">com</span>

<span class="n">dig</span> <span class="nd">@10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">54</span> <span class="n">www</span><span class="o">.</span><span class="n">umich</span><span class="o">.</span><span class="n">edu</span>
</pre></div>
</div>
<p><strong>Viewing Cache Statistics</strong></p>
<ul class="simple">
<li>In the SSH shell, type the following command:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tmsh</span> <span class="n">show</span> <span class="n">ltm</span> <span class="n">dns</span> <span class="n">cache</span> <span class="n">resolver</span> <span class="n">resolver</span><span class="o">-</span><span class="n">cache</span> <span class="o">|</span> <span class="n">more</span>
</pre></div>
</div>
<p>Your output should look similar to below with statistics. Bits
In/Out, Packets In/Out and Connections are of particular interest.</p>
<p><a class="reference internal" href="_images/image24.png"><img alt="image21" src="_images/image24.png" style="width: 5.76000in; height: 3.47000in;" /></a></p>
</div>
</div>
<div class="section" id="dnssec-validating-resolver">
<h2>10.6. DNSSEC Validating Resolver<a class="headerlink" href="#dnssec-validating-resolver" title="Permalink to this headline">¶</a></h2>
<p>In this use case, you will configure GTM as a DNSSEC validating
resolver which offloads heavy CPU computation to traditional
resolvers. This simply adds DNSSEC validation to the resolver-cache
use-case previously configured.
* Estimated completion time: 10 minutes</p>
<div class="section" id="id12">
<h3>10.6.1. Create a new DNS Cache<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Caches &gt; Cache List: Create</strong></li>
<li>Create a new DNS cache as shown in the table below.</li>
</ul>
<p><em>Keep the defaults if not noted in the table.</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="48%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">validating-resolver</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Resolver Type</strong></td>
<td>Validating Resolver</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>A Trust Anchor must be configured so that the validating resolver has
a starting point for validation. This can be done manually via the SSH console.
You can obtain the root server DS keys by using dig and its related
utilities as follows:</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the interest of time, the trust anchors are located on your
desktop as a text file named TrustAnchors.txt. You can simply cut
and paste the values into the GUI. If you want to run the
utilities to obtain the anchors, the commands are below for your
reference.</p>
</div>
<ul class="simple">
<li>Get the root name servers in DNSKEY format and output to the file “root-dnskey”</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">dig</span> <span class="o">+</span><span class="n">multi</span> <span class="o">+</span><span class="n">noall</span> <span class="o">+</span><span class="n">answer</span> <span class="n">DNSKEY</span> <span class="o">.</span> <span class="o">&gt;</span><span class="n">root</span><span class="o">-</span><span class="n">dnskey</span>
</pre></div>
</div>
<ul class="simple">
<li>Convert the root trust anchors from DNSKEY format to DS</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">dnssec</span><span class="o">-</span><span class="n">dsfromkey</span> <span class="o">-</span><span class="n">f</span> <span class="n">root</span><span class="o">-</span><span class="n">dnskey</span> <span class="o">.</span> <span class="o">&gt;</span><span class="n">root</span><span class="o">-</span><span class="n">ds</span>
</pre></div>
</div>
<ul class="simple">
<li>Output of the root DS keys</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">cat</span> <span class="o">./</span><span class="n">root</span><span class="o">-</span><span class="n">ds</span>

<span class="n">IN</span> <span class="n">DS</span> <span class="mi">19036</span> <span class="mi">8</span> <span class="mi">1</span> <span class="n">B256BD09DC8DD59F0E0F0D8541B8328DD986DF6E</span>

<span class="n">IN</span> <span class="n">DS</span> <span class="mi">19036</span> <span class="mi">8</span> <span class="mi">2</span>
<span class="mi">49</span><span class="n">AAC11D7B6F6446702E54A1607371607A1A41855200FD2CE1CDDE32</span> <span class="n">F24E8FB5</span>
</pre></div>
</div>
<ul class="simple">
<li>Each of the 2 lines in the TrustAnchor.txt file should be entered as
a new trust anchor (2 total).</li>
<li>In the GUI, navigate to: <strong>DNS &gt; Caches &gt; Cache List</strong>. Select
“validating-resolver” and click on <strong>Trust Anchors</strong> on the top
menu. Click <strong>Add</strong>. Copy each line from the TrustAnchor.txt file
as a Trust Anchor entry. You should end with a total of two
entries.</li>
<li>The figure below shows what your configuration should look like.</li>
</ul>
<p><a class="reference internal" href="_images/image25.png"><img alt="image22" src="_images/image25.png" style="width: 4.00694in; height: 1.06042in;" /></a></p>
</div>
<div class="section" id="id13">
<h3>10.6.2. Create a new DNS Profile<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>In this task we will create a dns profile to be used by a listener for DNSSEC validation.
* In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Profiles &gt; DNS: Create</strong>.
* Create a new DNS profile as shown in the table below.</p>
<p><em>Keep the defaults if not noted in the table.</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Name</strong></th>
<th class="head">Validating</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>DNSSEC</strong></td>
<td>Disabled</td>
</tr>
<tr class="row-odd"><td><strong>GSLB</strong></td>
<td>Disabled</td>
</tr>
<tr class="row-even"><td><strong>DNS Express</strong></td>
<td>Disabled</td>
</tr>
<tr class="row-odd"><td><strong>DNS Cache</strong></td>
<td>Enabled</td>
</tr>
<tr class="row-even"><td><strong>DNS Cache Name</strong></td>
<td>validating-resolver</td>
</tr>
<tr class="row-odd"><td><strong>Unhandled Query Action</strong></td>
<td>Drop</td>
</tr>
<tr class="row-even"><td><strong>Use BIND Server on Big-IP</strong></td>
<td>Disabled</td>
</tr>
<tr class="row-odd"><td><strong>Logging</strong></td>
<td>Enabled</td>
</tr>
<tr class="row-even"><td><strong>Logging Profile</strong></td>
<td>dns-logging //from previous lab</td>
</tr>
<tr class="row-odd"><td><strong>AVR Statistics Sampling Rate</strong></td>
<td>Enabled; 1/1 queries sampled</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id14">
<h3>10.6.3. Edit DNS Listener<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>We will now apply the new profile to the existing DNS Listener.</p>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Delivery &gt; Listeners &gt; Listener List</strong></li>
<li>Select ‘<strong>resolver-listener</strong>’ and modify the DNS Profile to use “<strong>validating</strong>”.</li>
<li>Your Listener should now be setup as a validating resolver.</li>
<li><strong>Use-Case: Valid Signed Zone.</strong> From your workstation, perform
several recursive queries to your external Listener to test. Perform the following command
2 or 3 times:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dig</span> <span class="nd">@10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">54</span> <span class="n">internetsociety</span><span class="o">.</span><span class="n">org</span>
</pre></div>
</div>
<ul class="simple">
<li>In the SSH shell, type the following:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tmsh</span> <span class="n">show</span> <span class="n">ltm</span> <span class="n">dns</span> <span class="n">cache</span> <span class="n">validating</span><span class="o">-</span><span class="n">resolver</span> <span class="o">|</span> <span class="n">more</span>
</pre></div>
</div>
<p>Your output should look similar to below with statistics. Response
Validation and DNSSEC Key stats are of particular interest in this use-case.</p>
<p><a class="reference internal" href="_images/image26.png"><img alt="image23" src="_images/image26.png" style="width: 5.76000in; height: 3.47000in;" /></a></p>
<ul class="simple">
<li>In the GUI, you can find similar data as above by navigating
<strong>Statistics &gt; Module Statistics &gt; DNS &gt; Caches</strong>.</li>
<li>Select “Statistics Type” of Caches.</li>
<li>Select “View” under the Details column for validating-resolver</li>
<li>Note the size of the cache for just this single RR query. You can
view what’s in the cache from the CLI with:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tmsh</span> <span class="n">show</span> <span class="n">ltm</span> <span class="n">dns</span> <span class="n">cache</span> <span class="n">records</span> <span class="n">rrset</span> <span class="n">cache</span> <span class="n">validating</span><span class="o">-</span><span class="n">resolver</span> <span class="o">|</span> <span class="n">more</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>Use-Case: Invalid Signed Zone:</strong> From your workstation, perform
several recursive queries to your external Listener to test. Perform the
following command 2 or 3 times:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dig</span> <span class="nd">@10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">54</span> <span class="n">dnssec</span><span class="o">-</span><span class="n">failed</span><span class="o">.</span><span class="n">org</span>
</pre></div>
</div>
<ul class="simple">
<li>Run the same steps above to view statistics and see the difference</li>
<li>What happens when trust is broken.</li>
<li>What statistic incremented?</li>
<li>What was the query response to the client?</li>
</ul>
</div>
</div>
<div class="section" id="forwarders">
<h2>10.7. Forwarders<a class="headerlink" href="#forwarders" title="Permalink to this headline">¶</a></h2>
<p>In this use-case, we will configure conditional forwarders with local
zone information.</p>
<ul class="simple">
<li>Estimated completion time: 5 minutes</li>
</ul>
<div class="section" id="add-forwarder-to-existing-cache">
<h3>10.7.1. Add Forwarder to Existing Cache<a class="headerlink" href="#add-forwarder-to-existing-cache" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>In the GUI, navigate to: <strong>DNS &gt; Caches &gt; Cache List</strong>. Click on
<strong>validating-resolver</strong> from the previous exercise. Click <strong>Forward Zones</strong>
from the top menu.</li>
<li>Click <strong>Add</strong> and configure as shown in the figure below and then
click <strong>Finished</strong>:</li>
</ul>
<p><a class="reference internal" href="_images/image27.png"><img alt="image24" src="_images/image27.png" style="width: 4.31000in; height: 2.82000in;" /></a></p>
<ul class="simple">
<li>From your workstation, perform the following recursive queries to your
external Listener to test.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dig</span> <span class="nd">@10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">54</span> <span class="n">www</span><span class="o">.</span><span class="n">forward</span><span class="o">.</span><span class="n">com</span>

<span class="n">dig</span> <span class="nd">@10</span><span class="o">.</span><span class="mf">128.10</span><span class="o">.</span><span class="mi">54</span> <span class="n">mail</span><span class="o">.</span><span class="n">forward</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<ul class="simple">
<li>In the SSH shell, type the following tmsh command:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tmsh</span> <span class="n">show</span> <span class="n">ltm</span> <span class="n">dns</span> <span class="n">cache</span> <span class="n">validating</span><span class="o">-</span><span class="n">resolver</span> <span class="o">|</span> <span class="n">more</span>
</pre></div>
</div>
<p>Your output should look similar to below with statistics. Forwarder
Activity stats are of particular interest in this use-case.</p>
<p><a class="reference internal" href="_images/image28.png"><img alt="image25" src="_images/image28.png" style="width: 5.76000in; height: 3.47000in;" /></a></p>
<ul class="simple">
<li>In the GUI, you can find similar data as above by navigating
<strong>Statistics &gt; Module Statistics &gt; DNS &gt; Caches</strong>.</li>
<li>Select “Statistics Type” of Caches.</li>
<li>Select “View” under the Details column for validating-resolver</li>
</ul>
</div>
</div>
<div class="section" id="dns-201-class-is-complete-thanks-for-attending">
<h2>10.8. DNS 201 class is complete !  Thanks for attending!<a class="headerlink" href="#dns-201-class-is-complete-thanks-for-attending" title="Permalink to this headline">¶</a></h2>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="big-iq/index.html" class="btn btn-neutral" title="9. BIG-IQ" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Agility DNS team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>